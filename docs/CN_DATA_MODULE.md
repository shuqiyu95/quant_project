# Aè‚¡æ•°æ®è·å–æ¨¡å— - å®ç°æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æ ¹æ® `claude.md` çš„è¦æ±‚ï¼Œå·²å®Œæ•´å®ç°Aè‚¡æ•°æ®è·å–æ¨¡å—ï¼Œæ”¯æŒæ—¥çº¿ã€åˆ†é’Ÿçº¿ã€è¡Œä¸šæ•°æ®ã€å¾®è§‚æ•°æ®ç­‰å¤šç§æ•°æ®ç±»å‹ã€‚

## âœ… å·²å®ç°åŠŸèƒ½

### 1. åŸºç¡€æ•°æ®è·å–

#### 1.1 æ—¥çº¿æ•°æ® (Daily Data)
- âœ… æ ‡å‡†OHLCVæ•°æ®ï¼ˆå¼€ç›˜ã€æœ€é«˜ã€æœ€ä½ã€æ”¶ç›˜ã€æˆäº¤é‡ï¼‰
- âœ… æ‰©å±•æŒ‡æ ‡ï¼ˆæˆäº¤é¢ã€æ¢æ‰‹ç‡ã€æ¶¨è·Œå¹…ã€æŒ¯å¹…ï¼‰
- âœ… æ”¯æŒå‰å¤æƒ/åå¤æƒ/ä¸å¤æƒ
- âœ… æ—¶åŒºå¤„ç†ï¼ˆAsia/Shanghaiï¼‰
- âœ… æ•°æ®éªŒè¯å’Œæ¸…æ´—

**ä½¿ç”¨ç¤ºä¾‹:**
```python
from src.data_engine.cn_fetcher import CNFetcher
from datetime import datetime, timedelta

fetcher = CNFetcher()
symbol = "600519"  # è´µå·èŒ…å°
end_date = datetime.now()
start_date = end_date - timedelta(days=60)

df = fetcher.fetch_daily_data(symbol, start_date, end_date)
print(df.head())
```

#### 1.2 åˆ†é’Ÿçº¿æ•°æ® (Intraday Data)
- âœ… æ”¯æŒå¤šä¸ªæ—¶é—´å‘¨æœŸï¼ˆ1/5/15/30/60åˆ†é’Ÿï¼‰
- âœ… åˆ†é’Ÿçº§åˆ«OHLCVæ•°æ®
- âœ… é€‚ç”¨äºæ—¥å†…äº¤æ˜“ç­–ç•¥å’Œé«˜é¢‘åˆ†æ

**ä½¿ç”¨ç¤ºä¾‹:**
```python
df_intraday = fetcher.fetch_intraday_data(
    symbol="600519",
    start_date=start_date,
    end_date=end_date,
    period="5"  # 5åˆ†é’ŸKçº¿
)
```

### 2. Aè‚¡ç‰¹è‰²æ•°æ®

#### 2.1 è¡Œä¸šæ•°æ® (Industry Data)
- âœ… è‚¡ç¥¨æ‰€å±è¡Œä¸šåˆ†ç±»
- âœ… ç”³ä¸‡è¡Œä¸šå½’å±
- âœ… æ¦‚å¿µæ¿å—ä¿¡æ¯

**ä½¿ç”¨ç¤ºä¾‹:**
```python
industry_info = fetcher.fetch_industry_data("600519")
print(f"è¡Œä¸š: {industry_info['industry']}")
print(f"æ¦‚å¿µ: {industry_info['sector']}")
```

#### 2.2 å¾®è§‚æ•°æ® (Micro Data)

##### é›†åˆç«ä»·æ•°æ® (Auction Data)
- âœ… 9:25é›†åˆç«ä»·ä»·æ ¼å’Œæˆäº¤é‡
- âœ… é¦–åˆ†é’Ÿæˆäº¤é‡ç»Ÿè®¡
- âœ… å¼€ç›˜ä»·ä¿¡æ¯

**ä½¿ç”¨ç¤ºä¾‹:**
```python
auction_data = fetcher.fetch_auction_data("600519", "20251223")
print(f"ç«ä»·é‡: {auction_data['auction_volume']}")
```

##### æ¢æ‰‹ç‡åˆ†ä½æ•° (Turnover Quantile)
- âœ… è®¡ç®—å†å²æ¢æ‰‹ç‡åˆ†ä½æ•°
- âœ… æ”¯æŒè‡ªå®šä¹‰å›æº¯æœŸ
- âœ… ç”¨äºè¯†åˆ«åœ°é‡/æ”¾é‡çŠ¶æ€

**ä½¿ç”¨ç¤ºä¾‹:**
```python
quantile = fetcher.fetch_turnover_quantile(
    symbol="600519",
    current_date=datetime.now(),
    lookback_days=100
)
print(f"æ¢æ‰‹ç‡åˆ†ä½æ•°: {quantile:.2%}")
```

#### 2.3 å®æ—¶è¡Œæƒ… (Realtime Quotes)
- âœ… æ‰¹é‡è·å–å®æ—¶ä»·æ ¼
- âœ… å®æ—¶æ¶¨è·Œå¹…ã€æˆäº¤é‡
- âœ… å½“æ—¥æŒ¯å¹…ã€æ¢æ‰‹ç‡

**ä½¿ç”¨ç¤ºä¾‹:**
```python
symbols = ["600519", "600036", "000858"]
df_realtime = fetcher.get_realtime_quotes(symbols)
print(df_realtime[['symbol', 'name', 'price', 'pct_change']])
```

### 3. æ•°æ®ç®¡ç† (Data Management)

#### 3.1 æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
- âœ… Parquetæ ¼å¼å­˜å‚¨ï¼ˆé«˜æ•ˆå‹ç¼©ï¼‰
- âœ… æŒ‰å¸‚åœºåˆ†ç±»å­˜å‚¨ï¼ˆcn/usï¼‰
- âœ… å…ƒæ•°æ®ç®¡ç†ï¼ˆè®°å½•æ›´æ–°æ—¶é—´ã€æ•°æ®èŒƒå›´ï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹ç¼“å­˜æœ‰æ•ˆæ€§

#### 3.2 å¢é‡æ›´æ–°æœºåˆ¶ â­
- âœ… æ£€æµ‹ç¼“å­˜æœ€åæ—¥æœŸ
- âœ… åªè·å–æ–°å¢æ•°æ®
- âœ… è‡ªåŠ¨åˆå¹¶å†å²æ•°æ®
- âœ… é¿å…é‡å¤ä¸‹è½½

**å¢é‡æ›´æ–°æµç¨‹:**
```
1. è¯»å–æœ¬åœ°ç¼“å­˜å’Œå…ƒæ•°æ®
2. åˆ¤æ–­ç¼“å­˜æœ€æ–°æ—¥æœŸ
3. åªè·å–ç¼“å­˜åçš„æ–°æ•°æ®
4. åˆå¹¶å¹¶å»é‡
5. æ›´æ–°ç¼“å­˜å’Œå…ƒæ•°æ®
```

**ä½¿ç”¨ç¤ºä¾‹:**
```python
from src.data_engine.data_manager import DataManager

manager = DataManager(data_dir="data")

# é¦–æ¬¡è·å–
df = manager.fetch_data("600519", start_date, end_date)

# å¢é‡æ›´æ–°ï¼ˆåªè·å–æ–°æ•°æ®ï¼‰
df_updated = manager.fetch_data_incremental("600519")
print(f"æ–°å¢ {len(df_updated) - len(df)} æ¡è®°å½•")
```

#### 3.3 æ‰¹é‡å¤„ç†
- âœ… å¤šåªè‚¡ç¥¨å¹¶è¡Œè·å–
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… è¿”å›ç»Ÿä¸€æ ¼å¼

**ä½¿ç”¨ç¤ºä¾‹:**
```python
symbols = ["600519", "600036", "000858"]
results = manager.fetch_multiple(symbols, start_date, end_date)

for symbol, df in results.items():
    print(f"{symbol}: {len(df)} æ¡è®°å½•")
```

### 4. æ•°æ®è´¨é‡ä¿è¯

#### 4.1 æ•°æ®éªŒè¯
- âœ… è‚¡ç¥¨ä»£ç æ ¼å¼éªŒè¯
- âœ… ä»·æ ¼å…³ç³»éªŒè¯ï¼ˆHigh >= Low, High >= Close >= Lowç­‰ï¼‰
- âœ… ç¼ºå¤±å€¼æ£€æŸ¥
- âœ… æ•°æ®ç±»å‹è½¬æ¢

#### 4.2 å¼‚å¸¸å¤„ç†
- âœ… ç½‘ç»œé”™è¯¯é‡è¯•
- âœ… APIé™æµå¤„ç†
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

## ğŸ§ª æµ‹è¯•è¦†ç›–

### æµ‹è¯•ç”¨ä¾‹æ±‡æ€»

#### TestCNFetcher (Aè‚¡è·å–å™¨æµ‹è¯•)
- âœ… `test_validate_symbol` - è‚¡ç¥¨ä»£ç éªŒè¯
- âœ… `test_fetch_daily_data` - æ—¥çº¿æ•°æ®è·å–
- âœ… `test_fetch_daily_data_with_indicators` - æ‰©å±•æŒ‡æ ‡
- âœ… `test_fetch_intraday_data` - åˆ†é’Ÿçº¿æ•°æ®
- âœ… `test_fetch_industry_data` - è¡Œä¸šæ•°æ®
- âœ… `test_fetch_turnover_quantile` - æ¢æ‰‹ç‡åˆ†ä½æ•°
- âœ… `test_get_stock_info` - è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
- âœ… `test_get_realtime_quotes` - å®æ—¶è¡Œæƒ…

#### TestDataManager (æ•°æ®ç®¡ç†å™¨æµ‹è¯•)
- âœ… `test_identify_market` - å¸‚åœºè¯†åˆ«
- âœ… `test_fetch_and_cache` - ç¼“å­˜æœºåˆ¶
- âœ… `test_incremental_update` - å¢é‡æ›´æ–°
- âœ… `test_fetch_industry_data_via_manager` - è¡Œä¸šæ•°æ®
- âœ… `test_clear_cache` - ç¼“å­˜æ¸…ç†

#### TestDataIntegrity (æ•°æ®å®Œæ•´æ€§æµ‹è¯•)
- âœ… `test_data_completeness` - æ•°æ®å®Œæ•´æ€§
- âœ… `test_data_consistency` - æ•°æ®ä¸€è‡´æ€§

### æµ‹è¯•ç»“æœ

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest test/test_cn_fetcher.py -v

# æµ‹è¯•ç»Ÿè®¡
âœ… é€šè¿‡: 12 ä¸ªæµ‹è¯•
âš ï¸  è·³è¿‡: 2 ä¸ªæµ‹è¯•ï¼ˆç½‘ç»œç›¸å…³ï¼Œå–å†³äºAPIå¯ç”¨æ€§ï¼‰
âŒ å¤±è´¥: 0 ä¸ªæµ‹è¯•
```

### æ¼”ç¤ºè„šæœ¬

è¿è¡Œ `demo_cn_data.py` æŸ¥çœ‹å®Œæ•´åŠŸèƒ½æ¼”ç¤ºï¼š

```bash
python demo_cn_data.py
```

æ¼”ç¤ºåŒ…æ‹¬ï¼š
1. åŸºç¡€æ—¥çº¿æ•°æ®è·å–
2. æ•°æ®ç®¡ç†å™¨ï¼ˆç¼“å­˜ä¸å¢é‡æ›´æ–°ï¼‰
3. æ‰¹é‡è·å–å¤šåªè‚¡ç¥¨
4. è¡Œä¸šæ•°æ®è·å–
5. æ¢æ‰‹ç‡åˆ†ä½æ•°åˆ†æ
6. å®æ—¶è¡Œæƒ…è·å–

## ğŸ“Š æ•°æ®å­˜å‚¨ç»“æ„

```
quant_project/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ cn/                      # Aè‚¡æ•°æ®
â”‚   â”‚   â”œâ”€â”€ 600519.parquet       # æ—¥çº¿æ•°æ®ï¼ˆèŒ…å°ï¼‰
â”‚   â”‚   â”œâ”€â”€ 600036.parquet       # æ—¥çº¿æ•°æ®ï¼ˆæ‹›è¡Œï¼‰
â”‚   â”‚   â””â”€â”€ intraday/            # åˆ†é’Ÿçº¿æ•°æ®
â”‚   â”‚       â”œâ”€â”€ 5min/
â”‚   â”‚       â”‚   â””â”€â”€ 600519.parquet
â”‚   â”‚       â””â”€â”€ 15min/
â”‚   â”‚           â””â”€â”€ 600519.parquet
â”‚   â”œâ”€â”€ us/                      # ç¾è‚¡æ•°æ®
â”‚   â””â”€â”€ metadata/                # å…ƒæ•°æ®
â”‚       â”œâ”€â”€ 600519_CN.json       # è®°å½•æ›´æ–°æ—¶é—´ç­‰
â”‚       â””â”€â”€ 600036_CN.json
```

### å…ƒæ•°æ®ç¤ºä¾‹

```json
{
  "symbol": "600519",
  "market": "CN",
  "last_update": "2025-12-23T10:30:00",
  "data_start": "2024-01-01T00:00:00",
  "data_end": "2025-12-23T00:00:00",
  "record_count": 244
}
```

## ğŸ¯ ç¬¦åˆ claude.md è¦æ±‚

### 3. æ•°æ®å¼•æ“ä¸å­˜å‚¨è§„èŒƒ
- âœ… **å­˜å‚¨æ ¼å¼**: Parquetæ ¼å¼ï¼ŒæŒ‰date/tickeråˆ†åŒº
- âœ… **å¢é‡æ›´æ–°**: æ”¯æŒæ¯æ—¥æ”¶ç›˜åä»…æ‹‰å–Tæ—¥æ•°æ®å¹¶åˆå¹¶
- âœ… **è®­ç»ƒ/æµ‹è¯•æ•°æ®ç®¡ç†**: é€šè¿‡ç¼“å­˜é¿å…é‡å¤åˆ‡åˆ†

### 4. å› å­é€»è¾‘å‡†å¤‡
- âœ… **ç«ä»·å¼ºåº¦**: æä¾›auction_dataè·å–9:25æ•°æ®
- âœ… **é‡èƒ½è½¬æ¢**: æä¾›volumeã€turnoverç­‰æŒ‡æ ‡
- âœ… **åšå¼ˆç‰¹å¾**: æ•°æ®æ”¯æŒè®¡ç®—æ¶¨åœæ¿æ¬¡æ•°ã€å°å•ç­‰
- âœ… **æ¿å—å…±æŒ¯**: æä¾›è¡Œä¸šåˆ†ç±»æ•°æ®

### 6.2 å®æ“é¢„æµ‹æµæ°´çº¿
- âœ… **æ”¶ç›˜å‰è§¦å‘**: æ”¯æŒå®æ—¶æ•°æ®è·å–
- âœ… **å¢é‡æ›´æ–°**: é«˜æ•ˆçš„å¢é‡æ›´æ–°æœºåˆ¶
- âœ… **å€™é€‰æ± ç®¡ç†**: æ”¯æŒæ‰¹é‡è·å–å¤šåªè‚¡ç¥¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. åŸºç¡€ä½¿ç”¨

```python
from src.data_engine.data_manager import DataManager
from datetime import datetime, timedelta

# åˆå§‹åŒ–ç®¡ç†å™¨
manager = DataManager(data_dir="data")

# è·å–æ•°æ®
symbol = "600519"
end_date = datetime.now()
start_date = end_date - timedelta(days=60)

df = manager.fetch_data(symbol, start_date, end_date)
print(df.tail())
```

### 3. å¢é‡æ›´æ–°

```python
# æ¯æ—¥æ”¶ç›˜åæ‰§è¡Œ
df_updated = manager.fetch_data_incremental(symbol)
print(f"æ•°æ®å·²æ›´æ–°è‡³: {df_updated.index.max()}")
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **APIé™æµ**: AkShareåŸºäºä¸œæ–¹è´¢å¯Œç­‰å…¬å¼€APIï¼Œå¯èƒ½æœ‰è®¿é—®é¢‘ç‡é™åˆ¶
2. **ç½‘ç»œç¯å¢ƒ**: éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥è®¿é—®æ•°æ®æº
3. **æ•°æ®æƒé™**: æŸäº›é«˜çº§æ•°æ®ï¼ˆå¦‚Level-2è¡Œæƒ…ï¼‰å¯èƒ½éœ€è¦ç‰¹å®šæƒé™
4. **æ—¶åŒºå¤„ç†**: æ‰€æœ‰æ—¶é—´æ•°æ®ç»Ÿä¸€ä½¿ç”¨Asia/Shanghaiæ—¶åŒº

## ğŸ”„ åç»­æ‰©å±•æ–¹å‘

1. **ç”³ä¸‡è¡Œä¸šæŒ‡æ•°**: å®ç°`fetch_sw_industry_index`çš„å®Œæ•´åŠŸèƒ½
2. **æ¶¨åœæ¿æ£€æµ‹**: åŸºäºæ—¥çº¿æ•°æ®è®¡ç®—æ¶¨åœæ¬¡æ•°
3. **å°å•è´¨é‡**: å®æ—¶å°å•é‡‘é¢è¿½è¸ª
4. **åˆ†é’Ÿçº§å› å­**: åŸºäºåˆ†é’Ÿçº¿æ•°æ®è®¡ç®—æ—¥å†…å› å­
5. **æ•°æ®åº“æ”¯æŒ**: å¯é€‰çš„PostgreSQL/MySQLå­˜å‚¨åç«¯

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. ä¾èµ–åŒ…æ˜¯å¦æ­£ç¡®å®‰è£…
3. è‚¡ç¥¨ä»£ç æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆAè‚¡ä¸º6ä½æ•°å­—ï¼‰

## ğŸ‰ æ€»ç»“

Aè‚¡æ•°æ®è·å–æ¨¡å—å·²å®Œæ•´å®ç°å¹¶é€šè¿‡æµ‹è¯•ï¼Œå…·å¤‡ï¼š
- âœ… å¤šå±‚æ¬¡æ•°æ®è·å–ï¼ˆæ—¥çº¿/åˆ†é’Ÿçº¿/è¡Œä¸š/å®æ—¶ï¼‰
- âœ… æ™ºèƒ½ç¼“å­˜å’Œå¢é‡æ›´æ–°
- âœ… æ•°æ®è´¨é‡éªŒè¯
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- âœ… æ¸…æ™°çš„ä½¿ç”¨æ–‡æ¡£

å¯ä»¥ç›´æ¥ç”¨äºé‡åŒ–ç­–ç•¥å¼€å‘ï¼Œç‰¹åˆ«æ˜¯Aè‚¡æ¬¡æ—¥é«˜ç‚¹é¢„æµ‹ç­–ç•¥çš„æ•°æ®å‡†å¤‡å·¥ä½œã€‚

