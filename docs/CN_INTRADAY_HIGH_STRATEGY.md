# A股次日高点预测策略文档

## 📋 概述

本策略旨在预测A股个股次日开盘后30分钟内的最高涨幅，用于开盘买入、高点卖出的交易策略。

## 🎯 策略逻辑

### 核心思想

1. **标签定义**：次日开盘后30分钟内的最高涨幅（相对于开盘价）
2. **多分类任务**：将涨幅分为5个桶
   - `<-3%`: 下跌超过3%
   - `-3%~0%`: 小幅下跌
   - `0%~3%`: 小幅上涨
   - `3%~6%`: 中等上涨（目标）
   - `>6%`: 大幅上涨（目标）

3. **交易规则**：
   - 当预测涨幅 >= 3% 且置信度 > 0.4 时，次日开盘买入
   - 开盘后30分钟卖出（或达到目标涨幅后卖出）

### 适用场景

- 适合有T+0交易能力的账户（融券等）
- 或用于次日短线交易的参考
- 可结合其他因子优化选股

## 🔧 特征工程

### 1. Alpha158 因子（158个）

使用标准的Alpha158因子库，包括：
- 价格动量因子
- 技术指标因子
- 波动率因子
- 量价因子

### 2. A股特色因子（80+个）

#### 量能因子
- `turnover_quantile`: 换手率分位数（近100天）
- `volume_ratio`: 量比（今日量/5日均量）
- `volume_change_5d/20d`: 成交量变化率

#### 价格动量因子
- `return_1d/3d/5d/10d/20d`: 多周期收益率
- `amplitude_5d/10d/20d`: 振幅
- `price_position`: 收盘价在当日范围内的位置

#### 情绪因子
- `consecutive_up/down`: 连续涨跌天数
- `is_high_20d/low_20d`: 是否创20日新高/新低

#### 波动率因子
- `volatility_5d/10d/20d`: 历史波动率
- `upside_volatility`: 上行波动率
- `downside_volatility`: 下行波动率

#### 竞价因子（需要分钟线数据）
- `auction_volume_ratio`: 竞价量占全天比例
- `auction_return`: 竞价涨幅

**注意**：竞价因子需要分钟线数据。如果没有分钟线数据，这些因子将为0。

## 🤖 模型实现

### 支持的模型

1. **随机森林（Random Forest）** - 默认
   - `n_estimators`: 200
   - `max_depth`: 15
   - `class_weight`: balanced（处理样本不平衡）

2. **梯度提升树（GBDT）**
   - `n_estimators`: 200
   - `max_depth`: 8
   - `learning_rate`: 0.05

### 训练流程

1. 数据准备：获取历史日线数据和分钟线数据（可选）
2. 特征计算：Alpha158 + A股特色因子
3. 标签生成：计算次日开盘后30分钟最高涨幅
4. 数据分箱：将涨幅转换为5个类别
5. 模型训练：使用随机森林或GBDT
6. 模型评估：准确率、分类报告、特征重要性

## 📊 回测框架

### 回测设置

- **初始资金**：100,000 元
- **佣金**：0.03%
- **滑点**：0.1%
- **印花税**：0.05%（卖出时）
- **交易制度**：T+1

### 回测逻辑

```python
for each trading day:
    1. 使用当日特征预测次日涨幅
    2. 如果预测 >= 3% 且置信度 > 0.4:
        - 次日开盘价买入（全仓或部分仓位）
        - 30分钟后卖出
    3. 更新投资组合价值
    4. 记录交易和收益
```

### 性能指标

- 总收益率
- 年化收益率
- 夏普比率
- 最大回撤
- 胜率
- 交易次数

## 🚀 使用指南

### 快速开始

```bash
cd /Users/yushuqi/Desktop/code/quant_project
python demo_cn_intraday_high.py
```

### 自定义使用

```python
from cn_intraday_high_strategy import CNIntradayHighPredictor

# 1. 初始化预测器
predictor = CNIntradayHighPredictor(
    model_type='random_forest',  # or 'gbdt'
    data_dir='data'
)

# 2. 准备数据集
X, y, dates = predictor.prepare_dataset(
    symbol='002202',  # 金风科技
    start_date='2022-01-01',
    end_date='2024-12-20',
    use_cache=True
)

# 3. 训练模型
predictor.train(
    X=X,
    y=y,
    validation_split=0.2
)

# 4. 保存模型
predictor.save('output/my_model.pkl')

# 5. 回测
backtest_results = predictor.backtest(
    symbol='002202',
    X_test=X_test,
    dates_test=dates_test,
    daily_df=daily_df,
    initial_capital=100000.0
)
```

### 更换股票代码

修改 `demo_cn_intraday_high.py` 中的配置：

```python
SYMBOL = '600519'  # 贵州茅台
STOCK_NAME = '贵州茅台'
START_DATE = '2022-01-01'
END_DATE = '2024-12-20'
```

常用A股代码示例：
- `600519`: 贵州茅台
- `000858`: 五粮液
- `600036`: 招商银行
- `002202`: 金风科技（默认）
- `300750`: 宁德时代

## 📈 性能优化建议

### 1. 数据质量改进

- **获取分钟线数据**：用于准确计算竞价因子和30分钟最高涨幅
- **更长的历史数据**：建议至少2-3年数据
- **数据清洗**：处理停牌、涨跌停等异常情况

### 2. 特征工程优化

- **行业因子**：加入同行业股票的表现
- **市场因子**：加入大盘走势、行业指数
- **高频因子**：利用分钟线计算盘中强度指标
- **情绪因子**：加入龙虎榜、资金流向等数据

### 3. 模型调优

- **样本平衡**：使用SMOTE等方法处理样本不平衡
- **特征选择**：使用递归特征消除（RFE）选择最重要的特征
- **模型集成**：结合多个模型的预测结果
- **超参数优化**：使用GridSearch或贝叶斯优化

### 4. 策略优化

- **动态仓位**：根据预测置信度调整仓位
- **止损止盈**：设置合理的止损和止盈点
- **选股池**：同时预测多只股票，选择最优的
- **时间过滤**：避开重要公告日、业绩发布日

## ⚠️ 风险提示

### 数据限制

1. **分钟线数据**：
   - AkShare的分钟线数据可能不稳定或有延迟
   - 建议使用付费数据源（如Wind、同花顺等）

2. **标签质量**：
   - 没有分钟线数据时，用次日开盘价近似，误差较大
   - 实际交易中需要实时监控价格

### 交易限制

1. **T+1 制度**：A股实行T+1，当日买入次日才能卖出
   - 本策略假设次日开盘买入，30分钟后卖出
   - 需要融券或期权等工具实现日内平仓

2. **涨跌停限制**：
   - 涨停时无法买入
   - 跌停时无法卖出
   - 需要在回测中考虑这些限制

3. **流动性风险**：
   - 小盘股可能难以在30分钟内完成交易
   - 建议只对流动性好的股票使用

### 策略风险

1. **过拟合**：模型在训练集上表现好，但实盘可能不佳
2. **市场环境变化**：牛熊市切换时策略可能失效
3. **黑天鹅事件**：突发利空可能导致大幅亏损

## 📝 改进方向

### 短期（1-2周）

- [ ] 优化标签生成逻辑（使用真实分钟线数据）
- [ ] 添加行业板块共振因子
- [ ] 实现多股票池选股功能
- [ ] 添加可视化功能（收益曲线、特征重要性等）

### 中期（1-2月）

- [ ] 集成多个模型（Random Forest + GBDT + LightGBM）
- [ ] 实现滚动窗口验证
- [ ] 添加实时预测功能
- [ ] 接入实时行情数据

### 长期（3-6月）

- [ ] 对接实盘交易接口
- [ ] 实现自动化交易
- [ ] 构建多策略组合
- [ ] Web界面展示

## 📚 参考资料

- [Qlib Alpha158 因子库](https://github.com/microsoft/qlib)
- [AkShare 文档](https://akshare.akfamily.xyz/)
- [sklearn 文档](https://scikit-learn.org/)

## 👥 贡献者

- Quant Team

## 📄 更新日志

### v1.0.0 (2025-12-23)

- ✅ 实现次日高点预测完整流程
- ✅ Alpha158 + A股特色因子
- ✅ 多分类模型训练
- ✅ 回测框架
- ✅ 金风科技演示脚本

---

**最后更新**: 2025-12-23  
**维护者**: Quant Team

